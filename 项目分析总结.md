# 项目知识点总结

## 一.支付宝支付

**1.创建数据库模型类**

创建应用payment

**2.接入支付宝**

支付宝提供沙箱环境，在沙箱环境里操作

支付宝开发者文档，python对接支付宝SDK

API列表（重点）



![æ¯ä"æµç¨](file:///E:/Python%E8%AF%BE%E7%A8%8B/%E7%BE%8E%E5%A4%9A%E5%95%86%E5%9F%8E/%E7%9B%B8%E5%85%B3%E8%AF%BE%E4%BB%B6%E6%80%BB/%E7%BE%8E%E5%A4%9A%E5%95%86%E5%9F%8E%E9%A1%B9%E7%9B%AE%E8%AF%BE%E4%BB%B6/images/%E7%94%B5%E8%84%91%E7%BD%91%E7%AB%99%E6%94%AF%E4%BB%98%E6%B5%81%E7%A8%8B%E5%9B%BE.png)

用户点击支付，向后端发起请求，后端向支付宝发起支付请求，支付宝返回支付网址参数，后端拿到参数拼接URL，返回给前端，浏览器展示支付界面。

**后端发送参数**：

- sign   签名
- order_id   订单编号
- total_amount   总金额
- return_url   重定向网址
- notify_url   通知网址

用户支付成功后，支付宝将用户重定向到商户网址

查看支付成功的两种方式：

1.Post请求notify_url，返回异步通知参数，是否支付成功

2.调用查询接口alipay.trade.query查看交易状态



**RSA2秘钥对**

非对称加密    两对密钥对

商户向支付宝发起请求时，签名中保存支付宝公钥，支付宝中私钥验签

支付宝向商户发起请求时，商户保存应用私钥，支付宝应用公钥签名



## 二.后台管理

使用xadmin管理后台

## 三.MySQL主从同步配置

**读写分离**：

MySQL master------>增删改           

MySQL slave --------->查             

在Docker中配置MySQL slave

在数据库中，多对多的设计建立关系表，尽量不要用外键



## 四.注册登录

### 注册

在用户注册中，需要实现以下接口：

- 图片验证码
- 短信验证码
- 用户名判断是否存在
- 手机号判断是否存在
- 注册保存用户数据



**短信验证码业务处理流程：**

1.检查图片验证码

2.检查是否在60s内有发送记录

3.生成短信验证码

4.保存短信验证码与发送记录

5.发送短信

**请求参数**： 路径参数与查询字符串参数

| 参数          | 类型       | 是否必须 | 说明                 |
| ------------- | ---------- | -------- | -------------------- |
| mobile        | str        | 是       | 手机号               |
| image_code_id | uuid字符串 | 是       | 图片验证码编号       |
| text          | str        | 是       | 用户输入的图片验证码 |

**返回数据**： JSON

| 返回值  | 类型 | 是否必传 | 说明         |
| ------- | ---- | -------- | ------------ |
| message | str  | 否       | OK，发送成功 |



Celery异步任务对列发送短信

开启worker

celery -A 任务函数的路径 -l info



### 登录

第三方登录

![image_1chfmm4nc9s02d9prroff1kcn9.png-167.9kB](http://static.zybuluo.com/jsutqb/m5tv1fo9phvcpxo2m49w9th2/image_1chfmm4nc9s02d9prroff1kcn9.png)

